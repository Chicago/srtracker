<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>311 Status</title>
		<style>
			article, aside, dialog, figure, footer, header,
			hgroup, menu, nav, section { display: block; }
		</style>
		<link rel="stylesheet" href="/static/arvo-fontfacekit/stylesheet.css" type="text/css" />
		<link rel="stylesheet" href="/static/css/service_request.css" type="text/css" />
	</head>
	<body>
		
		<header>
			<span class="site_title">311 Service Tracker</span>
			<form method="GET" action="/requests">
				<label id="request_id_label" for="status_lookup">Check the status of:</label>
				<input name="request_id" id="status_lookup" type="text" placeholder="Enter Service Request #" />
				<input type="submit" value="Submit" />
			</form>
		</header>
		
		<article class="main_content">
		
		<h1>{{ sr.service_name }} #{{ sr.service_request_id }}</h1>
		<p class="status_indicator status-{{ sr.status }}">{{ sr.status.title() }}</p>
		
		<aside class="request_extras">
			<div class="request_details">
				<h2>Original Request</h2>
				<dl>
					<dt>Service Type:</dt>
					<dd>{{ sr.service_name }}</dd>
					<dt>Description:</dt>
					<dd>{{ sr.description }}</dd>
					<dt>Address:</dt>
					<dd>{{ sr.address.title().split(",", 1)[0] }}<br/>{{ sr.address.title().split(",", 1)[1].replace("Il", "IL") }}</dd>
					<dt>Created:</dt>
					<dd>{{ sr.requested_datetime.strftime('%B %d, %Y') }}</dd>
					<dt>Received:</dt>
					<dd>{{ sr.received_via.title() }}</dd>
				</dl>
			</div>
			
			{% if sr.status == 'open' %}
				{% if subscribed %}
				<div class="request_details">
					<h2>You’ve Subscribed</h2>
					<p>
						Thanks for subscribing to updates for this request.
						We’ll e-mail you when work is done on this service request.
					</p>
				</div>
				{% else %}
				<div class="request_details">
					<h2>Stay Up To Date</h2>
					<p>Get notified of any changes to this service request by email.</p>
					<form method="POST" action="/subscribe/{{ sr.service_request_id }}">
						<label for="update_email">E-Mail:</label>
						<input type="email" id="update_email" name="update_email" />
						<input type="submit" value="Notify Me!" />
					</form>
				</div>
				{% endif %}
			{% endif %}
		</aside>
		
		<ol class="notes_list">
			{% for note in sr.notes %}
			<li class="note note-{{ note.type }}">
				<div class="note_indicator"></div>
				<span class="datetime">
					<span class="date">{{ note.datetime.strftime('%d-%b-%Y') }}</span>
					<span class="time">{{ note.datetime.strftime('%I:%M %p').strip('0') }}</span>
				</span>
				<div class="details">
					<p>
						
						{% if note.type == 'subrequest' %}
							<strong>{{ note.description }}</strong><br/>
							Department: {{ note.properties.agency_responsible }}
						{% else %}
							{{ note.description }}
						{% endif %}
					</p>
				</div>
			</li>
			{% endfor %}
			
			{# And of course the SR itself... #}
			<li class="note note-initial note-subrequest">
				<div class="note_indicator"></div>
				<span class="datetime">
					<span class="date">{{ sr.requested_datetime.strftime('%d-%b-%Y') }}</span>
					<span class="time">{{ sr.requested_datetime.strftime('%I:%M %p').strip('0') }}</span>
				</span>
				<div class="details">
					<p>
						{{ sr.service_name }}<br/>
						Department: {{ sr.agency_responsible }}<br/>
						via {{ sr.received_via.title() }}
					</p>
					<p>
						{{ sr.description }}
					</p>
				</div>
			</li>
		</ol>
		
		</article>
		
	</body>
</html>